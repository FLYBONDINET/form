<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login con Google</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
  body {
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #f4f4f4;
    margin: 0;
  }
  .login-box {
    background: #fff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    text-align: center;
    width: 320px;
  }
  h2 {
    margin-bottom: 20px;
  }
  #legajo-container {
    margin-top: 15px;
  }
  input {
    padding: 10px;
    width: 100%;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 14px;
  }
  button {
    padding: 10px;
    width: 100%;
    background: #142f61;
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }
  button:hover {
    background: #0b1b3a;
  }
  #errorMsg {
    margin-top: 10px;
    font-size: 14px;
    color: red;
  }
</style>
</head>
<body>
  <div class="login-box">
    <h2>Ingresar</h2>

    <!-- BotÃ³n de Google -->
    <div id="g_id_onload"
         data-client_id="234440818053-4jee2n6av03jtcfr0ga3i4gjvlgb7b4m.apps.googleusercontent.com"
         data-context="signin"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>
    <div class="g_id_signin" data-type="standard"></div>

    <!-- Campo de legajo -->
    <div id="legajo-container" style="display:none;">
      <input type="text" id="legajo" placeholder="NÃºmero de legajo">
      <button onclick="enviarDatos()">Ingresar</button>
      <div id="errorMsg"></div>
    </div>
  </div>

<script>
const ENDPOINT = "https://script.google.com/macros/s/AKfycbwyaW3eQhylczBO_RQShY76qsJ94S38jkizGXs5vW1G3sJSSd4wVk4aC3a4op9-ih6e/exec"; 
let userEmail = "";

// Google devuelve el Gmail autenticado
function handleCredentialResponse(response) {
  const data = JSON.parse(atob(response.credential.split('.')[1]));
  userEmail = data.email;

  // ðŸ”’ Solo permitir correos de un dominio especÃ­fico
  const dominioPermitido = "@flybondi.com"; // <-- cÃ¡mbialo por tu dominio real
  if (!userEmail.endsWith(dominioPermitido)) {
    document.getElementById("errorMsg").textContent =
      "Solo se permite acceso con correos del dominio " + dominioPermitido;
    userEmail = "";
    return;
  }

  document.getElementById("legajo-container").style.display = "block";
}

// Validar Gmail + legajo en Google Sheets
function enviarDatos(){
  const legajo = document.getElementById("legajo").value.trim();
  const errorMsg = document.getElementById("errorMsg");

  if (!legajo) {
    errorMsg.textContent = "Ingrese su nÃºmero de legajo";
    return;
  }

  fetch(ENDPOINT, {
    method: "POST",
    body: JSON.stringify({ mail: userEmail, legajo }),
    headers: { "Content-Type": "application/json" }
  })
  .then(res => res.json())
  .then(data => {
    if(data.success){
      sessionStorage.setItem("usuario", userEmail);
      window.location.href = "menu.html";
    } else {
      errorMsg.textContent = "Ingreso incorrecto";
    }
  })
  .catch(err => {
    errorMsg.textContent = "Error de conexiÃ³n";
    console.error(err);
  });
}
</script>
</body>
</html>
