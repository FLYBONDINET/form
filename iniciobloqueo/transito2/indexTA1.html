<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>T R Á N S I T O   1   </title>
<link rel="stylesheet" href="css/style.css">
</head>
<body data-theme="night" data-form="transito1">

<!-- Barra superior con botones y logo -->
<div class="top-bar">
  <div class="top-bar-left">
    <button class="btn ghost" onclick="irAtras()">Atrás</button>
  </div>

  <div class="top-bar-center">
    <img src="assets/logo.png" class="logo" alt="Logo">
  </div>

  <div class="top-bar-right">
    <button class="btn ghost" id="toggleTheme" type="button">Día/Noche</button>
    <button class="btn ghost" id="btnCerrarSesion" onclick="cerrarSesion()">Cerrar sesión</button>
  </div>
</div>

<header>
  <h1>T R Á N S I T O   2   </h1>
  <span class="chip" id="chipRow"></span>
</header>

<main>
  <!-- Datos de vuelo -->
  <section class="card">
    <div class="legend">Datos de vuelo <span class="icon">+</span></div>
    <div class="card-content">
      <div class="grid">
        <div class="field col-4"><label for="Fecha">Fecha</label><input type="date" id="Fecha" /></div>
        <div class="field col-4"><label for="Escala">Escala (IATA)</label><select id="Escala"></select></div>
        <div class="field col-4"><label for="Matricula">Matrícula</label><select id="Matricula"></select></div>
        <div class="field col-3"><label for="Llegada_Numero_Vuelo">LLegada vuelo FO</label><input id="Llegada_Numero_Vuelo" /></div>
        <div class="field col-3"><label for="Salida_Numero_Vuelo">Salida vuelo FO</label><input id="Salida_Numero_Vuelo" /></div>
        <div class="field col-3"><label for="Posición">Posición</label><input id="Posición" /></div>
      </div>
    </div>
  </section>

  <!-- Datos de Personal -->
  <section class="card">
    <div class="legend">Datos de Personal <span class="icon">+</span></div>
    <div class="card-content">
      <div class="grid">
        <div class="field col-3"><label for="SSR">SSR</label><input id="SSR" /></div>
        <div class="field col-3"><label for="Colaboradores_en_plataforma">Colaboradores en plataforma</label><input id="Colaboradores_en_plataforma" /></div>
        <div class="field col-3"><label for="Colaboradores_en_Patio_de_equipaje">Colaboradores en Patio de equipaje</label><input id="Colaboradores_en_Patio_de_equipaje" /></div>
        <div class="field col-3"><label for="Conciliacion_de_equipaje">Conciliacion de equipaje</label><input id="Conciliacion_de_equipaje" /></div>
        <div class="field col-3"><label for="Choferes_de_micro">Choferes de micro</label><input id="Choferes_de_micro" /></div>
        <div class="field col-3"><label for="Load_Control">Load Control</label><input id="Load_Control" /></div>
      </div>
    </div>
  </section>

  <!-- Equipajes y Carga -->
  <section class="card">
    <div class="legend">Equipajes y Carga <span class="icon">+</span></div>
    <div class="card-content">
      <div class="grid">
        <!-- Llegada -->
        <div class="field col-12">
          <button class="btn ghost" type="button" id="toggleDropdown">Llegada</button>
          <div id="extraDropdown">
            <div class="field col-3"><label for="Llegada__Cantidad_de_bultos_equipajes">Cantidad bultos equipajes</label><input type="number" min="0" id="Llegada__Cantidad_de_bultos_equipajes" /></div>
            <div class="field col-3"><label for="Llegada_KG_de_equipajes">KG de equipajes</label><input type="number" min="0" step="0.1" id="Llegada_KG_de_equipajes" /></div>
            <div class="field col-12">
              <button class="btn ghost" type="button" id="toggleDropdown4">Carga en Llegada</button>
              <div id="carga2">
                <div class="field col-3"><label for="Llegada_Cantidad_de_bultos_carga">Cantidad bultos carga</label><input type="number" min="0" id="Llegada_Cantidad_de_bultos_carga" /></div>
                <div class="field col-3"><label for="Llegada_KG_de_carga">KG de carga</label><input type="number" min="0" step="0.1" id="Llegada_KG_de_carga" /></div>
              </div>
            </div>
            <div class="field col-3"><label for="LLegada_Cantidad_PAX">Cantidad PAX</label><input type="number" min="0" id="LLegada_Cantidad_PAX" /></div>
          </div>
        </div>

        <!-- Salida -->
        <div class="field col-12">
          <button class="btn ghost" type="button" id="toggleDropdown2">Salida</button>
          <div id="salisa">
            <div class="field col-3"><label for="Salida_Cantidad_de_bultos_equipajes">Cantidad bultos equipajes</label><input type="number" min="0" id="Salida_Cantidad_de_bultos_equipajes" /></div>
            <div class="field col-3"><label for="Salida_KG_de_equipajes">KG de equipajes</label><input type="number" min="0" step="0.1" id="Salida_KG_de_equipajes" /></div>

            <div class="field col-12">
              <button class="btn ghost" type="button" id="toggleDropdown3">Carga en Salida</button>
              <div id="carga1">
                <div class="field col-3"><label for="Salida_Cantidad_de_bultos_carga">Cantidad bultos carga</label><input type="number" min="0" id="Salida_Cantidad_de_bultos_carga" /></div>
                <div class="field col-3"><label for="Salida_KG_de_carga">KG de carga</label><input type="number" min="0" step="0.1" id="Salida_KG_de_carga" /></div>
              </div>
            </div>

            <div class="field col-3"><label for="Salida_Cantidad_PAX">Cantidad PAX</label><input type="number" min="0" id="Salida_Cantidad_PAX" /></div>
          </div>
        </div>

        <div class="field col-3"><label for="Estado_de_bolsin">Estado de bolsin</label>
          <select id="Estado_de_bolsin">
            <option></option>
            <option>Sì</option>
            <option>No</option>
            <option>No Aplica</option>
          </select>
        </div>
        <div class="field col-3"><label for="Numero_de_precinto">Numero de precinto</label><input type="number" min="0" id="Numero_de_precinto" /></div>
      </div>
    </div>
  </section>

  <!-- Tiempos operativos -->
  <section class="card">
    <div class="legend">Tiempos operativos <span class="icon">+</span></div>
    <div class="card-content">
      <div class="grid" id="timeGrid"></div>

      <div class="field col-12">
        <button class="btn ghost" type="button" id="toggleAsu">ASU</button>
        <div id="asuBlock"></div>
      </div>
      <div class="small">Todos estos campos tienen botón ⏱ para cargar hora actual (editable).</div>
    </div>
  </section>

    <!-- Asistencias -->
  <section class="card">
    <div class="legend">Asistencias<span class="icon">+</span></div>
    <div class="card-content">
        <div class="field col-3"><label for="Asistencias Llegada">Asistencia arribo</label><input type="number" min="0" id="Asistencias Llegada" /></div>
        <div class="field col-3"><label for="Asistencias Salida">Asistencia salida</label><input type="number" min="0" id="Asistencias salida" /></div>
    </div>
  </section>

  <!-- internos -->
  <section class="card">
    <div class="legend">Internos <span class="icon">+</span></div>
    <div class="card-content">
      <div class="grid" id="internalGrid"></div>
    </div>
  </section>

  <!-- Observaciones -->
  <section class="card">
    <div class="legend">Observaciones <span class="icon">+</span></div>
    <div class="card-content">
      <textarea id="Observaciones" placeholder="Anotaciones operativas, novedades, etc."></textarea>
    </div>
  </section>
</main>

<div class="bar">
  <div class="status" id="saveStatus">Guardado local listo.</div>
  <button class="btn ghost" type="button" id="btnBorrarLocal">Borrar guardado local</button>
  <button class="btn" type="button" id="btnEnviar">Enviar Vuelo</button>
</div>

<!-- Scripts -->
<script src="js/script.js"></script>

<script>
  // ======= CONTROL DE SESIÓN =======
  if (!localStorage.getItem('usuarioActivo')) {
    window.location.href = "../index.html";
  }

  function cerrarSesion() {
    localStorage.removeItem('usuarioActivo');
    localStorage.clear();
    sessionStorage.clear();
    window.location.href = "../index.html";
  }

  function irAtras() {
    window.history.back(); // o: window.location.href = "menu.html";
  }

  // ======= TEMA: Auto noche 19:00–06:00 + toggle manual =======
  (function () {
    const ROOT = document.documentElement || document.body;
    const BTN = document.getElementById('toggleTheme');
    const LOCK_KEY = 'themeLockedThisSession'; // 'true' si el usuario tocó el botón en esta sesión
    const THEME_ATTR = 'data-theme';           // 'day' | 'night'

    function isNight(d = new Date()) {
      const h = d.getHours(); // hora local
      return (h >= 19 || h < 6); // Noche: 19–23 y 0–5
    }

    function applyTheme(theme) {
      ROOT.setAttribute(THEME_ATTR, theme);
      // (Opcional) Actualizar texto del botón
      if (BTN) BTN.textContent = theme === 'day' ? 'Día/Noche' : 'Día/Noche';
      // Si quisieras mostrar el estado, podrías poner:
      // BTN.textContent = theme === 'night' ? 'Cambiar a Día' : 'Cambiar a Noche';
    }

    function autoApplyIfUnlocked() {
      if (sessionStorage.getItem(LOCK_KEY) === 'false') return; // usuario eligió manual en esta sesión
      applyTheme(isNight() ? 'night' : 'day');
    }

    // Inicial: auto según hora
    autoApplyIfUnlocked();

    // Revisión periódica (cada 60s) para cambiar automáticamente si no está bloqueado
    setInterval(autoApplyIfUnlocked, 60 * 1000);

    // Toggle manual: bloquea auto para esta sesión
    if (BTN) {
      BTN.addEventListener('click', () => {
        const current = ROOT.getAttribute(THEME_ATTR) || (isNight() ? 'night' : 'day');
        const next = current === 'body' ? 'day' : 'night';
        applyTheme(next);
        sessionStorage.setItem(LOCK_KEY, 'true');
      });
    }
  })();
</script>


</body>
</html>
