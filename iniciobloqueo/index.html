<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rampa Flybondi - App M√≥vil</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Logo -->
  <img src="assets/logo.png" alt="Logo Flybondi" class="logo">

  <!-- Men√∫ principal -->
  <div class="container">
    <h1>‚úàÔ∏è  R A M P A  ‚úàÔ∏è</h1>
    <button class="button" onclick="location.href='rampa_llegada.html'">
      <i class="material-icons">flight_land</i> Vuelo Llegada 1
    </button>
        <button class="button" onclick="location.href='rampa_llegada.html'">
      <i class="material-icons">flight_land</i> Vuelo Llegada 2
    </button>
    <button class="button" onclick="location.href='salida/indexsalida.html'">
      <i class="material-icons">flight_takeoff</i> Vuelo Salida 1
    </button>
        <button class="button" onclick="location.href='salida/indexsalida.html'">
      <i class="material-icons">flight_takeoff</i> Vuelo Salida 2
    </button>
    <button class="button" onclick="location.href='proyectotransito/indexTA.html'">
      <i class="material-icons">flight</i> Vuelo en Tr√°nsito 1
    </button>
        <button class="button" onclick="location.href='proyectotransito2/indexTA1.html'">
      <i class="material-icons">flight</i> Vuelo en Tr√°nsito 2
    </button>
    <button class="button" onclick="location.href='historial/indexhistorial.html'">
      <i class="material-icons">history</i> Historial de Vuelos
    </button>

    <!-- Bot√≥n de cerrar sesi√≥n -->
    <button class="button logout" onclick="cerrarSesion()">
      <i class="material-icons">exit_to_app</i> Cerrar Sesi√≥n
    </button>
  </div>

  <script>
  // üîí Bloqueo de acceso directo usando usuarioActivo
  const sesion = localStorage.getItem("usuarioActivo");
  if (!sesion) {
      window.location.href = "../index.html"; // siempre redirige al index ra√≠z si no hay login
  }

  // üö™ Funci√≥n para cerrar sesi√≥n
  function cerrarSesion() {
      localStorage.removeItem("usuarioActivo"); 
      window.location.href = "../index.html";  // logout ‚Üí vuelve al login ra√≠z
  }

  // URL del Apps Script
  const urlVuelos = "https://script.google.com/macros/s/AKfycbwEz4pfgHUsmar2CNGaplmlgYDrsBzc0T8-0fS9Bj96y0eSeb1vTr3Lao51dIvIt4HC/exec";
  let tablaData = [];

  // Actualizar contadores seg√∫n columna A (Fecha)
  function actualizarContadores(){
    const hoy = new Date();
    const dia = hoy.toDateString();
    const mes = hoy.getMonth();
    const anio = hoy.getFullYear();

    const vuelosHoy = tablaData.filter(f => new Date(f.Fecha).toDateString() === dia).length;
    const vuelosMes = tablaData.filter(f => {
      const fecha = new Date(f.Fecha);
      return fecha.getMonth() === mes && fecha.getFullYear() === anio;
    }).length;
    const vuelosAnio = tablaData.filter(f => new Date(f.Fecha).getFullYear() === anio).length;

    document.getElementById("vuelosDia").textContent = `Vuelos hoy: ${vuelosHoy}`;
    document.getElementById("vuelosMes").textContent = `Vuelos mes: ${vuelosMes}`;
    document.getElementById("vuelosAnio").textContent = `Vuelos a√±o: ${vuelosAnio}`;
  }

  // Obtener datos de vuelos desde Apps Script
  function obtenerVuelos(){
    fetch(urlVuelos)
      .then(res => res.json())
      .then(data => {
        if(Array.isArray(data)){
          tablaData = data.map(f => ({ Fecha: f.Fecha || "" }));
          actualizarContadores();
        } else {
          console.error("Formato de datos incorrecto", data);
        }
      })
      .catch(err => console.error("Error fetch vuelos:", err));
  }

  // Inicializar
  obtenerVuelos();
  setInterval(obtenerVuelos, 10000);
  </script>
</body>
</html>
