<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rampa Flybondi - App M贸vil</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .top-bar {
      width: 100%;
      background-color: transparent; /* Fondo transparente */
      color: #000;
      font-weight: bold;
      padding: 10px;
      text-align: right;
    }
  </style>
</head>
<body>
  <!-- Barra superior con usuario -->
  <div class="top-bar">
    <span id="usuarioInfo"></span>
  </div>

  <!-- Logo -->
  <img src="assets/logo.png" alt="Logo Flybondi" class="logo">

  <!-- Men煤 principal -->
  <div class="container">
    <h1>锔  R A M P A  锔</h1>
    <button class="button" onclick="location.href='rampa_llegada.html'">
      <i class="material-icons">flight_land</i> Vuelo Llegada
    </button>
    <button class="button" onclick="location.href='salida/indexsalida.html'">
      <i class="material-icons">flight_takeoff</i> Vuelo Salida
    </button>
    <button class="button" onclick="location.href='proyectotransito/indexTA.html'">
      <i class="material-icons">flight</i> Vuelo en Tr谩nsito
    </button>
    <button class="button" onclick="location.href='historial/indexhistorial.html'">
      <i class="material-icons">history</i> Historial de Vuelos
    </button>

    <!-- Bot贸n de cerrar sesi贸n -->
    <button class="button logout" onclick="cerrarSesion()">
      <i class="material-icons">exit_to_app</i> Cerrar Sesi贸n
    </button>

    <!-- Contadores de vuelos -->
    <div id="vuelosContadores" style="margin-top:20px;">
      <p id="vuelosDia">Vuelos hoy: 0</p>
      <p id="vuelosMes">Vuelos mes: 0</p>
      <p id="vuelosAnio">Vuelos a帽o: 0</p>
    </div>
  </div>

  <script>
  //  Bloqueo de acceso directo usando usuarioActivo
  const sesion = localStorage.getItem("usuarioActivo");
  if (!sesion) {
      window.location.href = "../index.html"; 
  } else {
      let usuario;
      try {
          usuario = JSON.parse(sesion); // intento parsear
      } catch (e) {
          usuario = { email: sesion }; // si no es JSON, uso como string
      }

      // Mostrar usuario y legajo
      const email = usuario.email || "-";
      const legajo = usuario.legajo || "-";
      document.getElementById("usuarioInfo").textContent = `Usuario: ${email} | Legajo: ${legajo}`;
  }

  //  Funci贸n para cerrar sesi贸n
  function cerrarSesion() {
      localStorage.removeItem("usuarioActivo"); 
      window.location.href = "../index.html";  
  }

  // URL del Apps Script
  const urlVuelos = "https://script.google.com/macros/s/AKfycbwEz4pfgHUsmar2CNGaplmlgYDrsBzc0T8-0fS9Bj96y0eSeb1vTr3Lao51dIvIt4HC/exec";
  let tablaData = [];

  // Actualizar contadores seg煤n columna A (Fecha)
  function actualizarContadores(){
    const hoy = new Date();
    const dia = hoy.toDateString();
    const mes = hoy.getMonth();
    const anio = hoy.getFullYear();

    const vuelosHoy = tablaData.filter(f => new Date(f.Fecha).toDateString() === dia).length;
    const vuelosMes = tablaData.filter(f => {
      const fecha = new Date(f.Fecha);
      return fecha.getMonth() === mes && fecha.getFullYear() === anio;
    }).length;
    const vuelosAnio = tablaData.filter(f => new Date(f.Fecha).getFullYear() === anio).length;

    document.getElementById("vuelosDia").textContent = `Vuelos hoy: ${vuelosHoy}`;
    document.getElementById("vuelosMes").textContent = `Vuelos mes: ${vuelosMes}`;
    document.getElementById("vuelosAnio").textContent = `Vuelos a帽o: ${vuelosAnio}`;
  }

  // Obtener datos de vuelos desde Apps Script
  function obtenerVuelos(){
    fetch(urlVuelos)
      .then(res => res.json())
      .then(data => {
        if(Array.isArray(data)){
          tablaData = data.map(f => ({ Fecha: f.Fecha || "" }));
          actualizarContadores();
        } else {
          console.error("Formato de datos incorrecto", data);
        }
      })
      .catch(err => console.error("Error fetch vuelos:", err));
  }

  // Inicializar
  obtenerVuelos();
  setInterval(obtenerVuelos, 10000);
  </script>
</body>
</html>
